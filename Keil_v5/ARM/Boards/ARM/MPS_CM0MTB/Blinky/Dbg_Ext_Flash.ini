/******************************************************************************/
/* Dbg_Ext_Flash.ini: Initialization File for Debugging of External Flash     */
/******************************************************************************/
// <<< Use Configuration Wizard in Context Menu >>>                           // 
/******************************************************************************/
/* This file is part of the uVision/ARM development tools.                    */
/* Copyright (c) 2005-2012 Keil Software. All rights reserved.                */
/* This software may only be used under the terms of a valid, current,        */
/* end user licence from KEIL for a compatible version of KEIL software       */
/* development tools. Nothing else gives you the right to use this software.  */
/******************************************************************************/


FUNC void MTB_Setup (void) {
// <e0.0> Trace: MTB (Micro Trace Buffer)
//   <o1.0..5> Buffer Size
//     <5=>  256B
//     <6=>  512B
//     <7=>   1kB
//     <8=>   2kB
//     <9=>   4kB
//     <10=>  8kB
//     <11=> 16kB
//     <12=> 32kB
//   <o2>   Buffer Position
//     <i> Buffer position in RAM. Must be a multiple of the buffer size.
//   <o3.0> Stop Trace when buffer is full
//   <o3.1> Stop Target when buffer is full
// </e>
  unsigned long _mstr;
  unsigned long _mask;
  unsigned long _position;
  unsigned long _flow;
  _mstr      = 0x01;
  _mask      = 12;
  _position  = 0x1EFF0000;
  _flow      = 0x00;

  _position &= 0xFFFFFFFC;                               // Mask MASTER.POINTER field
  _flow      = _flow | (_position + ((8<<_mask) - 32));

  _WDWORD(0x1EFF8000, 0x00000000);                       // MASTER
  _WDWORD(0x1EFF8004, _mask);                            // RANGE
  _WDWORD(0x1EFF8008, _flow);                            // FLOW
  _WDWORD(0x1EFF8000, _mstr | _position);                // MASTER
}

MTB_Setup();
