/*----------------------------------------------------------------------------
 * Name:    STM32L1xx_DBG.ini
 * Purpose: STM32L1xx Debugger Initialization File
 * Note(s):
 *----------------------------------------------------------------------------
 * This file is part of the uVision/ARM development tools.
 * This software may only be used under the terms of a valid, current,
 * end user licence from KEIL for a compatible version of KEIL software
 * development tools. Nothing else gives you the right to use this software.
 *
 * This software is supplied "AS IS" without warranties of any kind.
 *
 * Copyright (c) 2008-2011 Keil - An ARM Company. All rights reserved.
 *----------------------------------------------------------------------------*/

// <<< Use Configuration Wizard in Context Menu >>>                           // 

/*----------------------------------------------------------------------------
  Setup()  configure PC & SP for RAM Debug
 *----------------------------------------------------------------------------*/
FUNC void DebugSetup (void) {
// <h> Debug MCU configuration register (DBGMCU_CR)
//   <o12.0>    DBG_SLEEP     <i> Debug Sleep Mode
//   <o12.1>    DBG_STOP      <i> Debug Stop Mode
//   <o12.2>    DBG_STANDBY   <i> Debug Standby Mode
//   <o12.5>    TRACE_IOEN    <i> Trace I/O Enable
//   <o12.6..7> TRACE_MODE    <i> Trace Mode
//             <0=> Asynchronous
//             <1=> Synchronous: TRACEDATA Size 1
//             <2=> Synchronous: TRACEDATA Size 2
//             <3=> Synchronous: TRACEDATA Size 4
// </h>

// <h> Debug MCU APB1 freeze register (DBGMCU_APB1_FZ)
//   <o14.0>    DBG_TIM2_STOP          <i> TIM2 counter stopped when core is halted
//   <o14.1>    DBG_TIM3_STOP          <i> TIM3 counter stopped when core is halted
//   <o14.2>    DBG_TIM4_STOP          <i> TIM4 counter stopped when core is halted
//   <o14.4>    DBG_TIM6_STOP          <i> TIM6 counter stopped when core is halted
//   <o14.5>    DBG_TIM7_STOP          <i> TIM7 counter stopped when core is halted
//   <o14.10>   DBG_RTC_STOP           <i> Debug RTC stopped when core is halted
//   <o14.11>   DBG_WWDG_STOP          <i> Debug window watchdog stopped when core is halted
//   <o14.12>   DBG_IWDG_STOP          <i> Debug independent watchdog stopped when core is halted
//   <o14.21>   DBG_I2C1_SMBUS_TIMEOUT <i> SMBUS timeout mode stopped when core is halted
//   <o14.22>   DBG_I2C2_SMBUS_TIMEOUT <i> SMBUS timeout mode stopped when core is halted
// </h>


// <h> Debug MCU APB2 freeze register (DBGMCU_APB2_FZ)
//   <o16.2>    DBG_TIM9_STOP          <i> TIM9 counter stopped when core is halted
//   <o16.3>    DBG_TIM10_STOP         <i> TIM10 counter stopped when core is halted
//   <o16.4>    DBG_TIM11_STOP         <i> TIM11 counter stopped when core is halted
// </h>

  _WDWORD(0x4002381C, _RDWORD(0x4002381C) | 0x00000010); // RCC_AHBENR:    IO port E clock enable
  _WDWORD(0x40021000, 0x00002AA0);                       // GPIOE_MODER:   PE2..PE6 = Alternate function mode
  _WDWORD(0x40021008, 0x00002AA0);                       // GPIOx_OSPEEDR: PE2..PE6 = 10 MHz Medium speed
  _WDWORD(0x4002100C, 0x00001550);                       // GPIOx_PUPDR:   PE2..PE6 = Pull-up
  _WDWORD(0x40021020, 0x00000000);                       // GPIOx_AFRL:    PE2..PE6 = AF0

  _WDWORD(0xE0042004, 0x00000027);                       // Set DBGMCU_CR
  _WDWORD(0xE0042008, 0x00000000);                       // DBGMCU_APB1_FZ
  _WDWORD(0xE004200C, 0x00000000);                       // DBGMCU_APB2_FZ
}

// Executed after reset via uVision's 'Reset'-button
FUNC void OnResetExec (void) {
  DebugSetup();
}

DebugSetup();                                           // Debugger Setup
