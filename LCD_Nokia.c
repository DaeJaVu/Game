// based off Nokia 5110 example from https://www.sparkfun.com/products/10168
// zip file with file LCD_Functions.h

#include "LCD_Nokia.h"

// hex values of pixels for a 5x8 font (WxH)
// Each byte in a row represents one, 8-pixel, vertical column of a character. 
// 5 bytes per character.
static const byte ASCII[][5] = 
{
  // First 32 characters (0x00-0x19) are ignored. These are
  // non-displayable, control characters.
   {0x00, 0x00, 0x00, 0x00, 0x00} // 0x20
  ,{0x00, 0x00, 0x5f, 0x00, 0x00} // 0x21 !
  ,{0x00, 0x07, 0x00, 0x07, 0x00} // 0x22 "
  ,{0x14, 0x7f, 0x14, 0x7f, 0x14} // 0x23 #
  ,{0x24, 0x2a, 0x7f, 0x2a, 0x12} // 0x24 $
  ,{0x23, 0x13, 0x08, 0x64, 0x62} // 0x25 %
  ,{0x36, 0x49, 0x55, 0x22, 0x50} // 0x26 &
  ,{0x00, 0x05, 0x03, 0x00, 0x00} // 0x27 '
  ,{0x00, 0x1c, 0x22, 0x41, 0x00} // 0x28 (
  ,{0x00, 0x41, 0x22, 0x1c, 0x00} // 0x29 )
  ,{0x14, 0x08, 0x3e, 0x08, 0x14} // 0x2a *
  ,{0x08, 0x08, 0x3e, 0x08, 0x08} // 0x2b +
  ,{0x00, 0x50, 0x30, 0x00, 0x00} // 0x2c ,
  ,{0x08, 0x08, 0x08, 0x08, 0x08} // 0x2d -
  ,{0x00, 0x60, 0x60, 0x00, 0x00} // 0x2e .
  ,{0x20, 0x10, 0x08, 0x04, 0x02} // 0x2f /
  ,{0x3e, 0x51, 0x49, 0x45, 0x3e} // 0x30 0
  ,{0x00, 0x42, 0x7f, 0x40, 0x00} // 0x31 1
  ,{0x42, 0x61, 0x51, 0x49, 0x46} // 0x32 2
  ,{0x21, 0x41, 0x45, 0x4b, 0x31} // 0x33 3
  ,{0x18, 0x14, 0x12, 0x7f, 0x10} // 0x34 4
  ,{0x27, 0x45, 0x45, 0x45, 0x39} // 0x35 5
  ,{0x3c, 0x4a, 0x49, 0x49, 0x30} // 0x36 6
  ,{0x01, 0x71, 0x09, 0x05, 0x03} // 0x37 7
  ,{0x36, 0x49, 0x49, 0x49, 0x36} // 0x38 8
  ,{0x06, 0x49, 0x49, 0x29, 0x1e} // 0x39 9
  ,{0x00, 0x36, 0x36, 0x00, 0x00} // 0x3a :
  ,{0x00, 0x56, 0x36, 0x00, 0x00} // 0x3b ;
  ,{0x08, 0x14, 0x22, 0x41, 0x00} // 0x3c <
  ,{0x14, 0x14, 0x14, 0x14, 0x14} // 0x3d =
  ,{0x00, 0x41, 0x22, 0x14, 0x08} // 0x3e >
  ,{0x02, 0x01, 0x51, 0x09, 0x06} // 0x3f ?
  ,{0x32, 0x49, 0x79, 0x41, 0x3e} // 0x40 @
  ,{0x7e, 0x11, 0x11, 0x11, 0x7e} // 0x41 A
  ,{0x7f, 0x49, 0x49, 0x49, 0x36} // 0x42 B
  ,{0x3e, 0x41, 0x41, 0x41, 0x22} // 0x43 C
  ,{0x7f, 0x41, 0x41, 0x22, 0x1c} // 0x44 D
  ,{0x7f, 0x49, 0x49, 0x49, 0x41} // 0x45 E
  ,{0x7f, 0x09, 0x09, 0x09, 0x01} // 0x46 F
  ,{0x3e, 0x41, 0x49, 0x49, 0x7a} // 0x47 G
  ,{0x7f, 0x08, 0x08, 0x08, 0x7f} // 0x48 H
  ,{0x00, 0x41, 0x7f, 0x41, 0x00} // 0x49 I
  ,{0x20, 0x40, 0x41, 0x3f, 0x01} // 0x4a J
  ,{0x7f, 0x08, 0x14, 0x22, 0x41} // 0x4b K
  ,{0x7f, 0x40, 0x40, 0x40, 0x40} // 0x4c L
  ,{0x7f, 0x02, 0x0c, 0x02, 0x7f} // 0x4d M
  ,{0x7f, 0x04, 0x08, 0x10, 0x7f} // 0x4e N
  ,{0x3e, 0x41, 0x41, 0x41, 0x3e} // 0x4f O
  ,{0x7f, 0x09, 0x09, 0x09, 0x06} // 0x50 P
  ,{0x3e, 0x41, 0x51, 0x21, 0x5e} // 0x51 Q
  ,{0x7f, 0x09, 0x19, 0x29, 0x46} // 0x52 R
  ,{0x46, 0x49, 0x49, 0x49, 0x31} // 0x53 S
  ,{0x01, 0x01, 0x7f, 0x01, 0x01} // 0x54 T
  ,{0x3f, 0x40, 0x40, 0x40, 0x3f} // 0x55 U
  ,{0x1f, 0x20, 0x40, 0x20, 0x1f} // 0x56 V
  ,{0x3f, 0x40, 0x38, 0x40, 0x3f} // 0x57 W
  ,{0x63, 0x14, 0x08, 0x14, 0x63} // 0x58 X
  ,{0x07, 0x08, 0x70, 0x08, 0x07} // 0x59 Y
  ,{0x61, 0x51, 0x49, 0x45, 0x43} // 0x5a Z
  ,{0x00, 0x7f, 0x41, 0x41, 0x00} // 0x5b [
  ,{0x02, 0x04, 0x08, 0x10, 0x20} // 0x5c \ (keep this to escape the backslash)
  ,{0x00, 0x41, 0x41, 0x7f, 0x00} // 0x5d ]
  ,{0x04, 0x02, 0x01, 0x02, 0x04} // 0x5e ^
  ,{0x40, 0x40, 0x40, 0x40, 0x40} // 0x5f _
  ,{0x00, 0x01, 0x02, 0x04, 0x00} // 0x60 `
  ,{0x20, 0x54, 0x54, 0x54, 0x78} // 0x61 a
  ,{0x7f, 0x48, 0x44, 0x44, 0x38} // 0x62 b
  ,{0x38, 0x44, 0x44, 0x44, 0x20} // 0x63 c
  ,{0x38, 0x44, 0x44, 0x48, 0x7f} // 0x64 d
  ,{0x38, 0x54, 0x54, 0x54, 0x18} // 0x65 e
  ,{0x08, 0x7e, 0x09, 0x01, 0x02} // 0x66 f
  ,{0x0c, 0x52, 0x52, 0x52, 0x3e} // 0x67 g
  ,{0x7f, 0x08, 0x04, 0x04, 0x78} // 0x68 h
  ,{0x00, 0x44, 0x7d, 0x40, 0x00} // 0x69 i
  ,{0x20, 0x40, 0x44, 0x3d, 0x00} // 0x6a j
  ,{0x7f, 0x10, 0x28, 0x44, 0x00} // 0x6b k
  ,{0x00, 0x41, 0x7f, 0x40, 0x00} // 0x6c l
  ,{0x7c, 0x04, 0x18, 0x04, 0x78} // 0x6d m
  ,{0x7c, 0x08, 0x04, 0x04, 0x78} // 0x6e n
  ,{0x38, 0x44, 0x44, 0x44, 0x38} // 0x6f o
  ,{0x7c, 0x14, 0x14, 0x14, 0x08} // 0x70 p
  ,{0x08, 0x14, 0x14, 0x18, 0x7c} // 0x71 q
  ,{0x7c, 0x08, 0x04, 0x04, 0x08} // 0x72 r
  ,{0x48, 0x54, 0x54, 0x54, 0x20} // 0x73 s
  ,{0x04, 0x3f, 0x44, 0x40, 0x20} // 0x74 t
  ,{0x3c, 0x40, 0x40, 0x20, 0x7c} // 0x75 u
  ,{0x1c, 0x20, 0x40, 0x20, 0x1c} // 0x76 v
  ,{0x3c, 0x40, 0x30, 0x40, 0x3c} // 0x77 w
  ,{0x44, 0x28, 0x10, 0x28, 0x44} // 0x78 x
  ,{0x0c, 0x50, 0x50, 0x50, 0x3c} // 0x79 y
  ,{0x44, 0x64, 0x54, 0x4c, 0x44} // 0x7a z
  ,{0x00, 0x08, 0x36, 0x41, 0x00} // 0x7b {
  ,{0x00, 0x00, 0x7f, 0x00, 0x00} // 0x7c |
  ,{0x00, 0x41, 0x36, 0x08, 0x00} // 0x7d }
  ,{0x10, 0x08, 0x08, 0x10, 0x08} // 0x7e ~
  ,{0x78, 0x46, 0x41, 0x46, 0x78} // 0x7f DEL
//,{0x1f, 0x24, 0x7c, 0x24, 0x1f} // 0x7f DEL (v2)
};

static const char ASCII_4x4pix[][4] = {
  {0x00, 0x00, 0x00, 0x00} // 0x20
  ,{0x0B, 0x00, 0x00, 0x00} // 0x21 !
  ,{0x03, 0x00, 0x03, 0x00} // 0x22 "
  ,{0x0F, 0x06, 0x0F, 0x02} // 0x23 #
  ,{0x0A, 0x0B, 0x0D, 0x05} // 0x24 $
  ,{0x09, 0x04, 0x02, 0x09} // 0x25 %
  ,{0x05, 0x0B, 0x05, 0x0A} // 0x26 &
  ,{0x00, 0x00, 0x01, 0x00} // 0x27 '
  ,{0x06, 0x09, 0x00, 0x00} // 0x28 (
  ,{0x09, 0x06, 0x00, 0x00} // 0x29 )
  ,{0x05, 0x02, 0x05, 0x00} // 0x2a *
  ,{0x02, 0x07, 0x02, 0x00} // 0x2b +
  ,{0x08, 0x04, 0x00, 0x00} // 0x2c ,
  ,{0x02, 0x02, 0x02, 0x02} // 0x2d -
  ,{0x00, 0x08, 0x00, 0x00} // 0x2e .
  ,{0x08, 0x04, 0x02, 0x01} // 0x2f /
  ,{0x0F, 0x09, 0x09, 0x0F} // 0x30 0
  ,{0x09, 0x09, 0x0F, 0x08} // 0x31 1
  ,{0x09, 0x0D, 0x0B, 0x09} // 0x32 2
  ,{0x09, 0x09, 0x0B, 0x0F} // 0x33 3
  ,{0x07, 0x04, 0x04, 0x0F} // 0x34 4
  ,{0x07, 0x0D, 0x0D, 0x0D} // 0x35 5
  ,{0x0F, 0x0A, 0x0A, 0x0E} // 0x36 6
  ,{0x01, 0x01, 0x01, 0x0F} // 0x37 7
  ,{0x07, 0x0D, 0x0B, 0x0E} // 0x38 8
  ,{0x07, 0x05, 0x05, 0x0F} // 0x39 9
  ,{0x00, 0x05, 0x00, 0x00} // 0x3a :
  ,{0x08, 0x05, 0x00, 0x00} // 0x3b ;
  ,{0x02, 0x05, 0x00, 0x00} // 0x3c <
  ,{0x05, 0x05, 0x05, 0x00} // 0x3d =
  ,{0x05, 0x02, 0x00, 0x00} // 0x3e >
  ,{0x01, 0x01, 0x0B, 0x03} // 0x3f ?
  ,{0x0F, 0x09, 0x06, 0x04} // 0x40 @
  ,{0x0F, 0x05, 0x05, 0x0F} // 0x41 A
  ,{0x0F, 0x05, 0x0A, 0x04} // 0x42 B
  ,{0x0F, 0x09, 0x09, 0x09} // 0x43 C
  ,{0x0F, 0x09, 0x09, 0x06} // 0x44 D
  ,{0x0F, 0x0B, 0x0B, 0x09} // 0x45 E
  ,{0x0F, 0x05, 0x05, 0x01} // 0x46 F
  ,{0x0F, 0x09, 0x09, 0x0D} // 0x47 G
  ,{0x0F, 0x04, 0x04, 0x0F} // 0x48 H
  ,{0x09, 0x0F, 0x09, 0x09} // 0x49 I
  ,{0x0D, 0x09, 0x09, 0x0F} // 0x4a J
  ,{0x0F, 0x02, 0x05, 0x09} // 0x4b K
  ,{0x0F, 0x08, 0x08, 0x08} // 0x4c L
  ,{0x0F, 0x01, 0x03, 0x0F} // 0x4d M
  ,{0x0F, 0x01, 0x02, 0x0F} // 0x4e N
  ,{0x0F, 0x09, 0x09, 0x0F} // 0x4f O
  ,{0x0F, 0x05, 0x05, 0x07} // 0x50 P
  ,{0x0F, 0x09, 0x0D, 0x0F} // 0x51 Q
  ,{0x0F, 0x05, 0x0D, 0x07} // 0x52 R
  ,{0x07, 0x0D, 0x0D, 0x0D} // 0x53 S
  ,{0x01, 0x0F, 0x01, 0x01} // 0x54 T
  ,{0x0F, 0x08, 0x08, 0x0F} // 0x55 U
  ,{0x07, 0x08, 0x08, 0x07} // 0x56 V
  ,{0x0F, 0x08, 0x0C, 0x0F} // 0x57 W
  ,{0x09, 0x06, 0x06, 0x09} // 0x58 X
  ,{0x07, 0x0C, 0x04, 0x07} // 0x59 Y
  ,{0x09, 0x0D, 0x0B, 0x09} // 0x5a Z
  ,{0x0F, 0x09, 0x00, 0x00} // 0x5b [
  ,{0x01, 0x02, 0x04, 0x08} // 0x5c '\'
  ,{0x09, 0x0F, 0x00, 0x00} // 0x5d ]
  ,{0x02, 0x01, 0x02, 0x00} // 0x5e ^
  ,{0x08, 0x08, 0x08, 0x08} // 0x5f _
  ,{0x01, 0x02, 0x00, 0x00} // 0x60 `
  ,{0x0F, 0x05, 0x05, 0x0F} // 0x41 A
  ,{0x0F, 0x05, 0x0A, 0x04} // 0x42 B
  ,{0x0F, 0x09, 0x09, 0x09} // 0x43 C
  ,{0x0F, 0x09, 0x09, 0x06} // 0x44 D
  ,{0x0F, 0x0B, 0x0B, 0x09} // 0x45 E
  ,{0x0F, 0x05, 0x05, 0x01} // 0x46 F
  ,{0x0F, 0x09, 0x09, 0x0D} // 0x47 G
  ,{0x0F, 0x04, 0x04, 0x0F} // 0x48 H
  ,{0x09, 0x0F, 0x09, 0x09} // 0x49 I
  ,{0x0D, 0x09, 0x09, 0x0F} // 0x4a J
  ,{0x0F, 0x02, 0x05, 0x09} // 0x4b K
  ,{0x0F, 0x08, 0x08, 0x08} // 0x4c L
  ,{0x0F, 0x01, 0x03, 0x0F} // 0x4d M
  ,{0x0F, 0x01, 0x02, 0x0F} // 0x4e N
  ,{0x0F, 0x09, 0x09, 0x0F} // 0x4f O
  ,{0x0F, 0x05, 0x05, 0x07} // 0x50 P
  ,{0x0F, 0x09, 0x0D, 0x0F} // 0x51 Q
  ,{0x0F, 0x05, 0x0D, 0x07} // 0x52 R
  ,{0x07, 0x0D, 0x0D, 0x0D} // 0x53 S
  ,{0x01, 0x0F, 0x01, 0x01} // 0x54 T
  ,{0x0F, 0x08, 0x08, 0x0F} // 0x55 U
  ,{0x07, 0x08, 0x08, 0x07} // 0x56 V
  ,{0x0F, 0x08, 0x0C, 0x0F} // 0x57 W
  ,{0x09, 0x06, 0x06, 0x09} // 0x58 X
  ,{0x07, 0x0C, 0x04, 0x07} // 0x59 Y
  ,{0x09, 0x0D, 0x0B, 0x09} // 0x5a Z
  ,{0x04, 0x0B, 0x09, 0x00} // 0x7b {
  ,{0x00, 0x0F, 0x00, 0x00} // 0x7c |
  ,{0x09, 0x0B, 0x04, 0x00} // 0x7d }
  ,{0x0B, 0x04, 0x0B, 0x04} // 0x7e ~
};

enum typeWrite{ // two memory banks in the LCD
 data, // RAM
 command
}

void static LCD_write(enum typeOfWrite type, char message)
{
  if(type == command)
	{
                                        // wait until SSI0 not busy/transmit FIFO empty
    while((SSI0_SR_R&SSI_SR_BSY)==SSI_SR_BSY){};
    DC = DC_command;
    SSI0_DR_R = message;                // command out
                                        // wait until SSI0 not busy/transmit FIFO empty
    while((SSI0_SR_R&SSI_SR_BSY)==SSI_SR_BSY){};
  } 
	else
	{
    while((SSI0_SR_R&SSI_SR_TNF)==0){}; // wait until transmit FIFO not full
    DC = DC_data;
    SSI0_DR_R = message;                // data out
  }
}

void LCD_init(void)
{
  volatile unsigned long delay;
  SYSCTL_RCGC1_R |= SYSCTL_RCGC1_SSI0;  // activate SSI0
  SYSCTL_RCGC2_R |= SYSCTL_RCGC2_GPIOA; // activate port A
  delay = SYSCTL_RCGC2_R;               // allow time to finish activating
  GPIO_PORTA_DIR_R |= 0xC0;             // make PA6,7 out
  GPIO_PORTA_AFSEL_R |= 0x2C;           // enable alt funct on PA2,3,5
  GPIO_PORTA_AFSEL_R &= ~0xC0;          // disable alt funct on PA6,7
  GPIO_PORTA_DEN_R |= 0xEC;             // enable digital I/O on PA2,3,5,6,7
                                        // configure PA2,3,5 as SSI
  GPIO_PORTA_PCTL_R = (GPIO_PORTA_PCTL_R&0xFF0F00FF)+0x00202200;
                                        // configure PA6,7 as GPIO
  GPIO_PORTA_PCTL_R = (GPIO_PORTA_PCTL_R&0x00FFFFFF)+0x00000000;
  GPIO_PORTA_AMSEL_R &= ~0xEC;          // disable analog functionality on PA2,3,5,6,7
  SSI0_CR1_R &= ~SSI_CR1_SSE;           // disable SSI
  SSI0_CR1_R &= ~SSI_CR1_MS;            // master mode
                                        // configure for system clock/PLL baud clock source
  SSI0_CC_R = (SSI0_CC_R&~SSI_CC_CS_M)+SSI_CC_CS_SYSPLL;
                                        // clock divider for 3.33 MHz SSIClk (80 MHz PLL/24)
                                        // SysClk/(CPSDVSR*(1+SCR))
                                        // 80/(24*(1+0)) = 3.33 MHz (slower than 4 MHz)
  SSI0_CPSR_R = (SSI0_CPSR_R&~SSI_CPSR_CPSDVSR_M)+24; // must be even number
  SSI0_CR0_R &= ~(SSI_CR0_SCR_M |       // SCR = 0 (3.33 Mbps data rate)
                  SSI_CR0_SPH |         // SPH = 0
                  SSI_CR0_SPO);         // SPO = 0
                                        // FRF = Freescale format
  SSI0_CR0_R = (SSI0_CR0_R&~SSI_CR0_FRF_M)+SSI_CR0_FRF_MOTO;
                                        // DSS = 8-bit data
  SSI0_CR0_R = (SSI0_CR0_R&~SSI_CR0_DSS_M)+SSI_CR0_DSS_8;
  SSI0_CR1_R |= SSI_CR1_SSE;            // enable SSI

  RESET = RESET_LOW;                    // reset the LCD to a known state
  for(delay=0; delay<10; delay=delay+1);// delay minimum 100 ns
  RESET = RESET_HIGH;                   // negative logic

  LCD_write(command, 0x21);             // chip active; horizontal addressing mode (V = 0); use extended instruction set (H = 1)
                                        // set LCD Vop (contrast)
  LCD_write(command, 0xB9);             // contrast ranges from 0xA0 (lighter) to 0xCF (darker)
  LCD_write(command, 0x04);             // set temp coefficient
  LCD_write(command, 0x14);             // LCD bias mode 1:48: try 0x13 or 0x14

  LCD_write(command, 0x20);             // need before modifying the display control mode
  LCD_write(command, 0x0C);             // set display control to normal mode: 0x0D for inverse
}